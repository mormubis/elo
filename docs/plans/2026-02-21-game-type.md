# GameType Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to
> implement this plan task-by-task.

**Goal:** Replace `isBlitz?: boolean` and `isRapid?: boolean` in
`KFactorOptions` and `GameOptions` with a single `gameType?: GameType` field,
making invalid combinations impossible by construction.

**Architecture:** Add a `GameType = 'blitz' | 'rapid' | 'standard'` type alias,
update both interfaces and the `kFactor`/`update` implementations in
`src/index.ts`, then update all affected test call sites in
`src/__tests__/index.spec.ts`. No new test cases needed — only call sites
change.

**Tech Stack:** TypeScript (strict, NodeNext), Vitest, pnpm.

---

### Task 1: Update types and implementation in `src/index.ts`

**Files:**

- Modify: `src/index.ts`

**Step 1: Add the `GameType` type alias**

Insert immediately before the `KFactorOptions` interface (after
`type Result = 0 | 0.5 | 1;`):

```ts
type GameType = 'blitz' | 'rapid' | 'standard';
```

**Step 2: Replace `isBlitz`/`isRapid` in `KFactorOptions`**

Replace:

```ts
interface KFactorOptions {
  age?: number;
  everHigher2400?: boolean;
  games?: number;
  isBlitz?: boolean;
  isRapid?: boolean;
  rating: number;
}
```

With:

```ts
interface KFactorOptions {
  age?: number;
  everHigher2400?: boolean;
  gameType?: GameType;
  games?: number;
  rating: number;
}
```

**Step 3: Replace `isBlitz`/`isRapid` in `GameOptions`**

Replace:

```ts
interface GameOptions {
  isBlitz?: boolean;
  isRapid?: boolean;
  result: Result;
}
```

With:

```ts
interface GameOptions {
  gameType?: GameType;
  result: Result;
}
```

**Step 4: Update the `kFactor` function**

Replace the destructuring and guard in `kFactor`:

Old destructuring:

```ts
function kFactor({
  age = 18,
  everHigher2400,
  games = 32,
  isBlitz = false,
  isRapid = false,
  rating,
}: KFactorOptions): 10 | 20 | 40 {
  // If the game is Blitz or Rapid type, return K-factor 20.
  if (isBlitz || isRapid) {
    return 20;
  }
```

New destructuring:

```ts
function kFactor({
  age = 18,
  everHigher2400,
  gameType,
  games = 32,
  rating,
}: KFactorOptions): 10 | 20 | 40 {
  // If the game is Blitz or Rapid type, return K-factor 20.
  if (gameType === 'blitz' || gameType === 'rapid') {
    return 20;
  }
```

**Step 5: Update the `kFactor` calls inside `update`**

In the two `kFactor({...})` calls inside `update`, replace:

```ts
isBlitz: game.isBlitz,
isRapid: game.isRapid,
```

With:

```ts
gameType: game.gameType,
```

Both calls — one for `playerA`, one for `playerB`.

**Step 6: Update the JSDoc for `kFactor`**

Replace the `@param isBlitz` and `@param isRapid` lines with:

```ts
 * @param gameType - The type of game: 'blitz', 'rapid', or 'standard'. Defaults to 'standard'.
```

**Step 7: Add `GameType` to the exports**

Change:

```ts
export type {
  GameOptions,
  KFactorOptions,
  PlayerOptions,
  Result,
  ResultAndOpponent,
};
```

To:

```ts
export type {
  GameOptions,
  GameType,
  KFactorOptions,
  PlayerOptions,
  Result,
  ResultAndOpponent,
};
```

**Step 8: Run lint**

```bash
pnpm lint
```

Expected: TypeScript errors only in `src/__tests__/index.spec.ts` (old
`isBlitz`/`isRapid` call sites). ESLint on source should be clean.

**Step 9: Commit**

```bash
git add src/index.ts
git commit -m "feat: replace isBlitz/isRapid with gameType discriminant field"
```

---

### Task 2: Update test call sites in `src/__tests__/index.spec.ts`

**Files:**

- Modify: `src/__tests__/index.spec.ts`

**Step 1: Update all `kFactor` call sites**

Find and update these 6 calls:

Old → New:

```ts
// 'returns 20 for a blitz game regardless of rating'
kFactor({ isBlitz: true, rating: 1400 })          → kFactor({ gameType: 'blitz', rating: 1400 })
kFactor({ isBlitz: true, rating: 2400 })          → kFactor({ gameType: 'blitz', rating: 2400 })
kFactor({ games: 5, isBlitz: true, rating: 1400 }) → kFactor({ gameType: 'blitz', games: 5, rating: 1400 })

// 'returns 20 for a rapid game regardless of rating'
kFactor({ isRapid: true, rating: 1400 })          → kFactor({ gameType: 'rapid', rating: 1400 })
kFactor({ isRapid: true, rating: 2400 })          → kFactor({ gameType: 'rapid', rating: 2400 })
kFactor({ games: 5, isRapid: true, rating: 1400 }) → kFactor({ gameType: 'rapid', games: 5, rating: 1400 })
```

**Step 2: Update all `update` call sites**

Find and update these 5 calls:

Old → New:

```ts
// 'Equal rating - blitz game'
update(1400, 1400, { isBlitz: true, result: 1 })  → update(1400, 1400, { gameType: 'blitz', result: 1 })
update(2300, 2300, { isBlitz: true, result: 1 })  → update(2300, 2300, { gameType: 'blitz', result: 1 })
update(2400, 2400, { isBlitz: true, result: 1 })  → update(2400, 2400, { gameType: 'blitz', result: 1 })

// 'Equal rating - rapid game'
update(1400, 1400, { isRapid: true, result: 1 })  → update(1400, 1400, { gameType: 'rapid', result: 1 })
update(2400, 2400, { isRapid: true, result: 1 })  → update(2400, 2400, { gameType: 'rapid', result: 1 })
```

**Step 3: Run full test suite**

```bash
pnpm test
```

Expected: all 41 tests pass.

**Step 4: Run lint**

```bash
pnpm lint
```

Expected: clean (zero errors, zero warnings).

**Step 5: Commit**

```bash
git add src/__tests__/index.spec.ts
git commit -m "test: update isBlitz/isRapid call sites to use gameType"
```

---

### Task 3: Bump version to 2.1.0 and update CHANGELOG

**Files:**

- Modify: `package.json`
- Modify: `CHANGELOG.md`

**Step 1: Bump version in `package.json`**

Change:

```json
"version": "2.0.0"
```

To:

```json
"version": "2.1.0"
```

**Step 2: Add `[2.1.0]` entry to `CHANGELOG.md`**

Insert after `## [Unreleased]`:

````md
## [2.1.0] - 2026-02-21

### Added

- `GameType` type (`'blitz' | 'rapid' | 'standard'`) exported from the package

### Changed

- `KFactorOptions` and `GameOptions` now use `gameType?: GameType` instead of
  the mutually exclusive `isBlitz?: boolean` / `isRapid?: boolean` pair

### Removed

- `isBlitz` and `isRapid` fields removed from `KFactorOptions` and
  `GameOptions`; use `gameType: 'blitz'` or `gameType: 'rapid'` instead

### Migration

```ts
// Before
kFactor({ isBlitz: true, rating: 1400 });
update(1400, 1600, { isRapid: true, result: 1 });

// After
kFactor({ gameType: 'blitz', rating: 1400 });
update(1400, 1600, { gameType: 'rapid', result: 1 });
```
````

````

**Step 3: Update comparison links at the bottom of `CHANGELOG.md`**

Change:
```md
[Unreleased]: https://github.com/mormubis/elo/compare/v2.0.0...HEAD
````

To:

```md
[Unreleased]: https://github.com/mormubis/elo/compare/v2.1.0...HEAD
[2.1.0]: https://github.com/mormubis/elo/compare/v2.0.0...v2.1.0
```

**Step 4: Run the full pre-PR check**

```bash
pnpm lint && pnpm test && pnpm build
```

Expected: all three pass.

**Step 5: Commit and push**

```bash
git add package.json CHANGELOG.md
git commit -m "chore: release v2.1.0"
git push
```
